# 채팅 내역 - 2025년 8월 4일

## 주요 작업 내용

### 1. JWT 토큰 오류 해결
- 문제: `JWT 토큰 오류: invalid signature` 발생
- 원인: backend-api와 chat-server 간 JWT_SECRET 불일치
- 해결: docker-compose.dev.yml에서 환경변수 통일

### 2. 채팅 삭제 기능 구현
- 채팅방 내 대화 내용 초기화 기능
- 최근 대화 목록에서 채팅방 삭제 기능
- API 엔드포인트 추가: DELETE /chat/rooms/{room_id}/messages, DELETE /chat/rooms/{room_id}

### 3. 대화내역 페이지 추가
- 네비게이션 바에 "대화내역" 버튼 추가
- 무한 스크롤로 모든 최근 대화 캐릭터 표시
- 채팅방 삭제 기능 포함

### 4. 캐릭터 채팅 카운트 기능
- 모든 사용자의 총 채팅 수 기록
- CharacterCard에 채팅 수 표시 (좋아요 수와 동일한 형식)
- 말풍선 뱃지 제거하고 깔끔한 텍스트 표시

### 5. AI 모델 선택 기능
- 채팅창 옵션 메뉴에 "모델 설정" 추가
- Gemini, Claude, GPT, ARGO 모델 선택 가능
- 대화 중 모델 변경 가능
- 사용자별 선호 모델 저장

### 6. 모델 설정 업데이트
- Nova → ARGO로 변경
- Gemini: 2.5 Pro, 2.5 Flash
- GPT: 4.1, 4.1 Mini, 4o
- Claude: 기존 유지
- 기본 모델: Gemini 2.5 Pro

### 7. 모달 UI 개선
- 현재 선택된 모델 상단 표시
- 포인트 컨테이너 제거
- 취소/확인 버튼 추가
- ARGO 모델 최하단 배치

### 8. 캐릭터 문맥 관리 진단
- 현재: 캐릭터 정보가 system prompt에만 포함
- 문제점: 대화 이력만으로는 캐릭터 특성 유지 어려움
- 해결 방향: 모든 캐릭터 정보를 매 요청마다 포함

### 9. 웹소설 통합 기능 계획 ("텍스트 챗")
- Story Importer 강화
- 에피소드 단위 파싱
- 50만자로 텍스트 제한 확대
- 파일 업로드 지원 (.txt, .hwp, .hwpx, .docx, .doc)

### 10. 무료 vs 프리미엄 차별화 전략
#### 무료 버전
- 기본 프롬프트 + 최근 10개 메시지
- 세션 단위 기억

#### 프리미엄 버전
- Option 1: 벡터 DB 활용 (무한 기억, 관계 추적)
- Option 2: 하이브리드 (긴 히스토리 + 요약 시스템)
- 추천: 단계별 구현 (즉시 개선 → 세션 저장 → 벡터 DB)

## 해결된 이슈들
1. ✅ JWT 토큰 시그니처 불일치
2. ✅ 프론트엔드 무한 리로드
3. ✅ 500 Internal Server Error
4. ✅ AI 응답 없음
5. ✅ 채팅 삭제 기능
6. ✅ 대화내역 페이지
7. ✅ 캐릭터 채팅 카운트
8. ✅ AI 모델 선택 기능

## 남은 작업
1. 캐릭터 정보 완전 전달 개선
2. Story Importer 강화
3. 파일 업로드 기능
4. 벡터 DB 통합 (프리미엄)
5. 에피소드 기반 대화 시스템