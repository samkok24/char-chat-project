# 2025-07-30 대화 기록 요약

## 1. 초기 목표
- 프로젝트 복습 및 현재 개발 상황 파악.
- `AI_캐릭터챗_개발_로드맵_및_DB설계서.md`와 `개발일지`들을 기반으로 진행 상황 분석 및 다음 할 일 도출.

## 2. 주요 문제 발생 및 해결 과정 (요약)
프로젝트 안정화를 시도하는 과정에서 연쇄적으로 다음과 같은 심각한 오류들이 발생했으며, 이를 해결하기 위해 수많은 시도를 함.

### 2-1. `ImportError` (순환 참조 및 의존성 문제)
- **문제**: `models/__init__.py`에서 `like`, `comment` 등 리팩토링된 모델을 import하지 못하는 문제 발생.
- **시도**: 모델 구조를 통합(Like, Comment)하고, 서비스와 API 계층을 모두 수정했으나, 이 과정에서 `user.py`, `character.py` 등 여러 파일의 관계(relationship) 설정이 꼬이며 다른 `ImportError`와 `ConfigurationError`를 유발.
- **결과**: 너무 많은 파일이 얽히면서 문제 해결이 어려워짐.

### 2-2. `UnsupportedCompilationError` (DB 비호환성 문제)
- **문제**: DB 초기화 후, SQLAlchemy가 `characters` 테이블을 생성하려 할 때 `UUID` 타입이 SQLite에서 지원되지 않아 서버 시작 실패.
- **시도**: SQLite와 PostgreSQL 모두에서 호환되는 `GUID` 커스텀 타입을 `database.py`에 정의하고, 모든 모델 파일의 `UUID`를 `GUID`로 교체 시도.
- **결과**: 이 과정에서 `JSON`, `func`, `Numeric` 등 다른 타입의 import를 누락하는 실수가 반복되어 `NameError`가 연쇄적으로 발생.

### 2-3. `ResponseValidationError` 및 `AttributeError` (데이터-스키마 불일치)
- **문제**: API가 DB에서 조회한 데이터(SQLAlchemy 모델)를 Pydantic 스키마로 변환하는 과정에서 필드가 맞지 않거나, 비동기 세션 문제(`MissingGreenlet`)로 인해 실패.
- **시도**: `@hybrid_property`, `@computed_field`, 수동 변환 등 여러 방법을 시도했으나, 복잡성만 증가하고 근본적인 해결에 실패.

### 2-4. `401 Unauthorized` 및 `invalid signature` (인증 문제)
- **문제**: `backend-api`와 `chat-server` 간의 JWT `SECRET_KEY`가 일치하지 않아 채팅 서버 연결이 계속 실패.
- **시도**: `.env` 파일을 공통으로 사용하도록 `docker-compose.dev.yml`을 수정하고, 디버깅 로그를 추가하여 양쪽 서버의 키가 일치하는지 확인. 브라우저 로컬 스토리지의 토큰 삭제 후 재로그인 시도.

## 3. 최종 결론 및 조치
- 수많은 시도에도 불구하고 연쇄적인 오류가 해결되지 않아, 더 이상의 코드 수정을 중단.
- **`git reset --hard HEAD`** 및 **`git pull`** 명령을 통해 프로젝트의 모든 로컬 변경 사항을 폐기하고, GitHub 저장소의 가장 안정적인 최신 버전으로 **완전 롤백**을 결정함.

## 4. 다음 단계
- 깨끗하게 롤백된 상태에서, 가장 근본적인 문제였던 **SQLite의 `UUID` 타입 미지원 오류**부터 다시, 신중하게 해결을 시도할 예정.