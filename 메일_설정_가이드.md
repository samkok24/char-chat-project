# 메일 발송 환경 변수 설정 가이드

## 📧 필수 환경 변수

메일 발송을 위해 다음 환경 변수들을 설정해야 합니다:

```env
SMTP_HOST=smtp.gmail.com          # SMTP 서버 주소
SMTP_PORT=587                      # SMTP 포트 (일반적으로 587 또는 465)
SMTP_USERNAME=your-email@gmail.com # SMTP 인증 이메일
SMTP_PASSWORD=your-password        # SMTP 비밀번호 또는 앱 비밀번호
SMTP_USE_TLS=true                  # TLS 사용 여부 (587 포트 사용 시 true)
SMTP_USE_SSL=false                 # SSL 사용 여부 (465 포트 사용 시 true)
EMAIL_FROM_ADDRESS=noreply@example.com  # 발신자 이메일 주소
EMAIL_FROM_NAME=AI 캐릭터 챗      # 발신자 이름
FRONTEND_BASE_URL=http://localhost:5173 # 프론트엔드 URL (메일 링크에 사용)
```

## 🔧 설정 방법

### 1. `.env` 파일 생성

프로젝트 루트 또는 `backend-api` 디렉토리에 `.env` 파일을 생성합니다.

```bash
# Windows PowerShell
cd backend-api
New-Item -Path .env -ItemType File

# 또는 메모장으로 직접 생성
```

### 2. 각 메일 서비스별 설정

#### 📮 Gmail 사용하기

**주의**: Gmail은 일반 비밀번호가 아닌 **앱 비밀번호**를 사용해야 합니다.

1. **2단계 인증 활성화** (필수)
   - Google 계정 설정 → 보안 → 2단계 인증 켜기

2. **앱 비밀번호 생성**
   - Google 계정 설정 → 보안 → 2단계 인증 → 앱 비밀번호
   - 앱 선택: "메일"
   - 기기 선택: "Windows 컴퓨터" 또는 "기타"
   - 생성된 16자리 비밀번호 복사

3. **`.env` 파일 설정**
```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=xxxx xxxx xxxx xxxx  # 앱 비밀번호 (공백 포함 가능)
SMTP_USE_TLS=true
SMTP_USE_SSL=false
EMAIL_FROM_ADDRESS=your-email@gmail.com
EMAIL_FROM_NAME=AI 캐릭터 챗
FRONTEND_BASE_URL=http://localhost:5173
```

#### 📮 네이버 메일 사용하기

```env
SMTP_HOST=smtp.naver.com
SMTP_PORT=587
SMTP_USERNAME=your-email@naver.com
SMTP_PASSWORD=your-naver-password
SMTP_USE_TLS=true
SMTP_USE_SSL=false
EMAIL_FROM_ADDRESS=your-email@naver.com
EMAIL_FROM_NAME=AI 캐릭터 챗
FRONTEND_BASE_URL=http://localhost:5173
```

**주의**: 네이버는 "메일 환경설정 → POP3/IMAP 설정"에서 "POP3/SMTP 사용"을 활성화해야 합니다.

#### 📮 구글 Workspace (G Suite) 사용하기

```env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@yourdomain.com
SMTP_PASSWORD=your-app-password  # 앱 비밀번호 필요
SMTP_USE_TLS=true
SMTP_USE_SSL=false
EMAIL_FROM_ADDRESS=noreply@yourdomain.com
EMAIL_FROM_NAME=AI 캐릭터 챗
FRONTEND_BASE_URL=http://localhost:5173
```

#### 📮 SendGrid 사용하기 (추천: 프로덕션)

SendGrid는 무료 플랜으로 월 100개까지 메일 발송 가능합니다.

1. [SendGrid 가입](https://sendgrid.com/)
2. API 키 생성: Settings → API Keys → Create API Key
3. SMTP 설정 확인: Settings → Sender Authentication

```env
SMTP_HOST=smtp.sendgrid.net
SMTP_PORT=587
SMTP_USERNAME=apikey
SMTP_PASSWORD=SG.xxxxxxxxxxxxx  # SendGrid API 키
SMTP_USE_TLS=true
SMTP_USE_SSL=false
EMAIL_FROM_ADDRESS=noreply@yourdomain.com  # 인증된 도메인 필요
EMAIL_FROM_NAME=AI 캐릭터 챗
FRONTEND_BASE_URL=http://localhost:5173
```

#### 📮 Amazon SES 사용하기

```env
SMTP_HOST=email-smtp.us-east-1.amazonaws.com  # 리전에 따라 변경
SMTP_PORT=587
SMTP_USERNAME=your-ses-smtp-username
SMTP_PASSWORD=your-ses-smtp-password
SMTP_USE_TLS=true
SMTP_USE_SSL=false
EMAIL_FROM_ADDRESS=noreply@yourdomain.com  # 인증된 이메일/도메인 필요
EMAIL_FROM_NAME=AI 캐릭터 챗
FRONTEND_BASE_URL=http://localhost:5173
```

## 🧪 개발 환경 (메일 발송 안 함)

개발 중에는 SMTP 설정을 하지 않아도 됩니다. 메일 발송 대신 로그만 출력됩니다.

```env
# SMTP 설정 비워두기
SMTP_HOST=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
```

또는 환경 변수를 아예 설정하지 않아도 됩니다.

## ✅ 설정 확인

1. `.env` 파일 저장
2. 백엔드 서버 재시작
3. 회원가입 테스트 → 로그 확인

**성공 시**: 메일이 발송됩니다.
**실패 시**: 로그에 에러 메시지가 출력됩니다.

## 🔍 문제 해결

### Gmail "앱에서 보안 수준이 낮은 앱의 액세스" 오류
- 해결: 앱 비밀번호를 사용하세요 (일반 비밀번호 사용 불가)

### 네이버 메일 "POP3/SMTP 사용 안 함" 오류
- 해결: 네이버 메일 설정에서 POP3/SMTP 사용을 활성화하세요

### 포트 587 연결 실패
- 해결: 방화벽이나 네트워크에서 포트 587이 차단되어 있는지 확인하세요
- 대안: 포트 465 사용 (SMTP_USE_SSL=true, SMTP_USE_TLS=false)

### "Authentication failed" 오류
- 해결: 사용자명/비밀번호가 정확한지 확인하세요
- Gmail: 앱 비밀번호를 사용하고 있는지 확인하세요

## 📝 참고사항

- **프로덕션 환경**: SendGrid, Amazon SES 등 전문 메일 서비스 사용 권장
- **개발 환경**: Gmail 또는 네이버 메일로 충분
- **보안**: `.env` 파일은 절대 Git에 커밋하지 마세요 (`.gitignore`에 추가)


