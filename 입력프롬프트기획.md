1. 개요 및 상태 흐름
입력 프롬프트 컴포넌트는 다음 4가지 주요 상태를 가집니다.

INITIAL: 사용자의 최초 입력을 대기하는 기본 상태.

GENERATING_AUTO: '자동 생성' 모드로 전체 스토리를 생성 중인 상태.

GENERATING_MANUAL_INIT: '수동 생성' 모드의 첫 200자를 생성 중인 상태.

AWAITING_MANUAL_INPUT: '수동 생성' 모드에서 사용자의 QTE 입력을 대기하는 인터랙티브 상태.

(사용자 진입)
      │
      ▼
┌───────────┐
│  INITIAL  │
└───────────┘
      │
      ├─ (자동 선택) ─► ┌──────────────────┐
      │               │ GENERATING_AUTO  │ ─(완료/중지)─► (INITIAL로 복귀)
      │               └──────────────────┘
      │
      └─ (수동 선택) ─► ┌────────────────────────┐
                      │ GENERATING_MANUAL_INIT │
                      └────────────────────────┘
                                │
                                ▼
                      ┌────────────────────────┐
                      │ AWAITING_MANUAL_INPUT  │ ◄───┐
                      └────────────────────────┘     │ (선택 입력)
                                │                    │
                                └────────────────────┘ (200자 추가 생성)
2. 상태별 상세 명세
2.1. INITIAL 상태 (최초 진입)
UI 구성 요소:

텍스트 입력 영역: 사용자가 아이디어를 입력하는 textarea.

생성 방식 선택 토글:

[ ✍️ 자동 생성 ]: AI가 전체 스토리를 완성합니다. (기본값)

[ 🎮 수동 생성 ]: 200자씩 상호작용하며 스토리를 만듭니다.

전송 버튼: 생성을 시작하는 버튼.

사용자 플로우:

사용자가 텍스트 영역에 프롬프트를 입력한다.

'자동' 또는 '수동' 생성 방식을 선택한다.

'전송' 버튼을 누른다.

2.2. GENERATING_AUTO 상태 (자동 생성 중)
진입 조건: INITIAL 상태에서 '자동 생성' 선택 후 프롬프트 전송.

UI 변경:

입력창과 선택 토글이 비활성화된다.

"스토리를 자동으로 생성하고 있습니다..." 메시지와 함께 중지 버튼이 표시된다.

API 호출:

POST /api/v1/generate/automatic

Body: { "prompt": "사용자 입력 내용" }

응답: 전체 스토리를 스트리밍으로 반환한다.

2.3. GENERATING_MANUAL_INIT 상태 (수동 모드 - 최초 생성)
진입 조건: INITIAL 상태에서 '수동 생성' 선택 후 프롬프트 전송.

UI 변경:

입력창과 선택 토글이 비활성화된다.

"이야기의 첫 단락을 생성하고 있습니다..." 메시지가 표시된다.

API 호출:

POST /api/v1/generate/manual/start

Body: { "prompt": "사용자 입력 내용" }

응답: 첫 200자 분량의 텍스트와 이 세션을 식별할 session_context_id를 반환한다.

2.4. AWAITING_MANUAL_INPUT 상태 (수동 모드 - QTE 대기)
진입 조건: GENERATING_MANUAL_INIT 또는 이전 AWAITING_MANUAL_INPUT에서의 생성이 완료된 후.

UI 대변환: 기존 입력 프롬프트 창이 아래와 같이 완전히 새로운 인터페이스로 교체된다.

컴포넌트:

커맨드 트레이 (Command Tray): 사용자가 선택한 버튼이 조합되는 영역.

QTE 타이머: 트레이 주변에 1.5초~2초 길이의 시각적 타이머가 표시되며, 첫 버튼 클릭 시 동작한다.

액션 버튼 그룹: [가다], [싸우다], [대화하다] 등 핵심 행동 버튼들이 고정 배치된다. 문맥에 맞는 동적 버튼이 추가될 수 있다.

이모지 버튼 그룹: 핵심 감정 이모지들이 고정 배치된다.

동작 로직 (QTE):

사용자가 버튼(액션/이모지)을 클릭하면 해당 아이콘이 '커맨드 트레이'에 추가된다. (다중 선택 가능)

첫 클릭과 동시에 QTE 타이머가 작동한다.

사용자는 타이머가 끝나기 전까지 원하는 만큼 버튼을 조합할 수 있다.

타이머가 종료되면 트레이에 담긴 조합이 자동으로 서버에 전송된다.

API 호출:

Trigger: QTE 타이머 종료 시.

POST /api/v1/generate/manual/next

Body: { "session_context_id": "이전 단계에서 받은 ID", "choices": ["ACTION_FIGHT", "EMOJI_ANGRY"] }

응답: 사용자의 선택이 반영된 다음 200자 분량의 텍스트를 반환한다. 이후 다시 AWAITING_MANUAL_INPUT 상태로 돌아가 루프를 형성한다.

3. 백엔드/LLM 프롬프트 가이드 (참고)
'수동 생성' 모드에서 .../manual/next API는 LLM에게 아래와 같은 형식의 프롬프트를 구성하여 전달해야 합니다.

목표: 사용자의 추상적인 선택(choices 배열)을 자연스러운 서사로 변환한다.

프롬프트 예시:

[이전 스토리 내용]
...그는 분노에 찬 표정으로 적과 싸우기 시작했다.

[다음 스토리 전개]
주인공은 이제 [슬픔을 느끼며] [어딘가로 걸어가야 한다].
이 상황을 세련되고 문학적인 문장으로 이어서 묘사해줘.
(여기서 [슬픔을 느끼며]와 [어딘가로 걸어가야 한다]는 EMOJI_SAD와 ACTION_WALK를 해석한 결과입니다.)