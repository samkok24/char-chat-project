# AI ìºë¦­í„°ì±— í”Œëž«í¼ - ì™„ì „í•œ ê°œë°œ ë¡œë“œë§µ & DB ì„¤ê³„ì„œ

## ðŸš€ **ìµœì‹  ì—…ë°ì´íŠ¸ (2025.07.14)**
> **ê³ ê¸‰ ìºë¦­í„° ê¸°ëŠ¥ êµ¬í˜„ ì™„ë£Œ!**
> - âœ… **ìºë¦­í„° ê´€ë¦¬ ê¸°ëŠ¥ ê³ ë„í™”**: ìƒì„¸ íŽ˜ì´ì§€ ë‚´ ê³µê°œ/ë¹„ê³µê°œ ì„¤ì •, ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ë° ì—…ë¡œë“œ ê¸°ëŠ¥ êµ¬í˜„
> - âœ… **ë§ˆì´íŽ˜ì´ì§€ ì—°ë™**: ìºë¦­í„° ì œìž‘ìž í”„ë¡œí•„ íŽ˜ì´ì§€ ì—°ë™ ë° ì†Œìœ ìž/ë°©ë¬¸ìž UI ë¶„ê¸° ì²˜ë¦¬
> - âœ… **ì‚¬ìš©ìž ê²½í—˜(UX) ê°œì„ **: ìºë¦­í„° ìƒì„±/ìˆ˜ì • í›„ 'ë’¤ë¡œê°€ê¸°' ì‹œ 'ë‚´ ìºë¦­í„° ëª©ë¡'ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ ê²½ë¡œ ìˆ˜ì •
> - âœ… **ì•„í‚¤í…ì²˜ ê°œì„ **: ë ˆê±°ì‹œ API ì‘ë‹µ ëª¨ë¸ì„ ìµœì‹  ë²„ì „ìœ¼ë¡œ í†µì¼í•˜ê³ , ì´ë¯¸ì§€ ìƒíƒœ ê´€ë¦¬ ë¡œì§ì„ ë¦¬íŒ©í† ë§í•˜ì—¬ ì•ˆì •ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± í–¥ìƒ

## ðŸš€ **ìµœì‹  ì—…ë°ì´íŠ¸ (2024.01.15)**
> **1ë‹¨ê³„ ê²°ì œ/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ë°±ì—”ë“œ êµ¬í˜„ ì™„ë£Œ!**
> - âœ… 9ê°œ API ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„ ì™„ë£Œ
> - âœ… Redis ê¸°ë°˜ ì›ìžì  í¬ì¸íŠ¸ ì°¨ê° ë¡œì§ ì™„ë£Œ
> - âœ… 4ê°œ í…Œì´ë¸” ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ

> **ì†Œì…œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„ ì™„ë£Œ! (2024.01.15)**
> - âœ… ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„ (4ê°œ API + ìžë™ ì¹´ìš´íŒ…)
> - âœ… ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ API ì¶”ê°€ (ìºë¦­í„°/ìŠ¤í† ë¦¬ë³„)
> - âœ… ëŒ“ê¸€ ìˆ˜ ìžë™ ì¶”ì  ì‹œìŠ¤í…œ (DB íŠ¸ë¦¬ê±° ì ìš©)
> - âœ… 14ê°œ ì†Œì…œ ê¸°ëŠ¥ API ì—”ë“œí¬ì¸íŠ¸ ì™„ë£Œ
> - âœ… ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ì™„ë£Œ
> - ðŸ”„ **ë‹¤ìŒ ìš°ì„ ìˆœìœ„**: ì•Œë¦¼ ì‹œìŠ¤í…œ ê°œë°œ ì‹œìž‘

---

## ðŸ“Š í”„ë¡œì íŠ¸ í˜„í™© ë¶„ì„

### ðŸŸ¢ ì´ë¯¸ êµ¬í˜„ëœ ê¸°ëŠ¥ (âœ…)
- **ì¸ì¦ ì‹œìŠ¤í…œ**: JWT ê¸°ë°˜ íšŒì›ê°€ìž…/ë¡œê·¸ì¸ ì™„ë£Œ
- **ê³ ê¸‰ ìºë¦­í„° ê¸°ëŠ¥**: ë§ˆì´íŽ˜ì´ì§€ ì—°ë™, ê³µê°œ/ë¹„ê³µê°œ ì„¤ì •, ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ë° ì—…ë¡œë“œ, UX ê°œì„  ë“± ìƒì„¸ ê¸°ëŠ¥ ê³ ë„í™”
- **ìºë¦­í„° ê´€ë¦¬**: ìƒì„±, ìˆ˜ì •, ì‚­ì œ, ì¢‹ì•„ìš” ê¸°ëŠ¥ ì™„ë£Œ
- **AI ì±„íŒ…**: Socket.IO ì‹¤ì‹œê°„ ì±„íŒ… + AI ì‘ë‹µ ìƒì„± ì™„ë£Œ
- **ìŠ¤í† ë¦¬ ìƒì„±**: ì›¹ì†Œì„¤ìƒì„±ë´‡ ë¡œì§ ê¸°ë°˜ 16ë‹¨ê³„ AI í˜‘ì—… ì‹œìŠ¤í…œ ì™„ë£Œ
- **ì†Œì…œ ê¸°ëŠ¥**: ì¢‹ì•„ìš”, ëŒ“ê¸€ ì‹œìŠ¤í…œ ì™„ë£Œ
- **ì¸í”„ë¼**: Docker Compose ê¸°ë°˜ ê°œë°œ í™˜ê²½ ì™„ë£Œ

### ðŸ”´ ë¯¸êµ¬í˜„ ê¸°ëŠ¥ (âŒ)
- **ì•Œë¦¼ ì‹œìŠ¤í…œ**: ì‹¤ì‹œê°„ ì•Œë¦¼ ë¯¸êµ¬í˜„
- **ëž­í‚¹/ì¶”ì²œ**: ì¸ê¸° ìºë¦­í„°/ìŠ¤í† ë¦¬ ëž­í‚¹ ë¯¸êµ¬í˜„
- **TTS/ì´ë¯¸ì§€ ìƒì„±**: ë©€í‹°ëª¨ë‹¬ AI ê¸°ëŠ¥ ë¯¸êµ¬í˜„
- **ê´€ë¦¬ìž ëŒ€ì‹œë³´ë“œ**: í†µê³„/ëª¨ë‹ˆí„°ë§ ë¯¸êµ¬í˜„

### ðŸŸ¢ ìµœê·¼ ì™„ë£Œëœ ê¸°ëŠ¥ (âœ… 2024.01.15)
- **ê²°ì œ/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ**: ë°±ì—”ë“œ ë¡œì§ ì™„ë£Œ
- **í¬ì¸íŠ¸ ì°¨ê° ë¡œì§**: Redis ê¸°ë°˜ ì›ìžì  ì²˜ë¦¬ ì™„ë£Œ
- **ê²°ì œ ìƒí’ˆ ê´€ë¦¬**: CRUD API ì™„ë£Œ
- **í¬ì¸íŠ¸ íŠ¸ëžœìž­ì…˜**: ì´ë ¥ ê´€ë¦¬ ì‹œìŠ¤í…œ ì™„ë£Œ

### ðŸŸ¢ ì†Œì…œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„ ì™„ë£Œ (âœ… 2024.01.15)
- **ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì‹œìŠ¤í…œ**: ì „ì²´ CRUD + ìžë™ ì¹´ìš´íŒ… ì™„ë£Œ
- **ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸**: ì‚¬ìš©ìžë³„ ì¢‹ì•„ìš” ìƒíƒœ API ì¶”ê°€
- **ëŒ“ê¸€ ìˆ˜ ìžë™ ì¶”ì **: DB íŠ¸ë¦¬ê±° ê¸°ë°˜ ì‹¤ì‹œê°„ ë™ê¸°í™”
- **14ê°œ ì†Œì…œ API**: ìºë¦­í„°/ìŠ¤í† ë¦¬ ì¢‹ì•„ìš”, ëŒ“ê¸€ ì‹œìŠ¤í…œ ì™„ë£Œ
- **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜**: StoryComment í…Œì´ë¸” + íŠ¸ë¦¬ê±° ì™„ë£Œ

---

## ðŸŽ¯ ë‹¨ê³„ë³„ API ê°œë°œ ë¡œë“œë§µ

### ðŸŸ¢ 0ë‹¨ê³„ â€“ í˜„ìž¬ êµ¬í˜„ ì™„ë£Œ âœ…
ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìžˆëŠ” APIë“¤ìž…ë‹ˆë‹¤.

| API | ì„¤ëª… | ìƒíƒœ |
|-----|-----|------|
| POST /auth/register | íšŒì›ê°€ìž… | âœ… |
| POST /auth/login | ë¡œê·¸ì¸ (JWT ë°œê¸‰) | âœ… |
| GET /auth/me | ë‚´ ì •ë³´ ì¡°íšŒ | âœ… |
| POST /characters | ìºë¦­í„° ìƒì„± | âœ… |
| GET /characters | ìºë¦­í„° ëª©ë¡ | âœ… |
| PUT /characters/{id} | ìºë¦­í„° ìˆ˜ì • | âœ… |
| POST /chat/rooms | ì±„íŒ…ë°© ìƒì„± | âœ… |
| POST /chat/messages | ë©”ì‹œì§€ ì „ì†¡ + AI ì‘ë‹µ | âœ… |
| POST /stories/generate | AI ìŠ¤í† ë¦¬ ìƒì„± | âœ… |
| **ì†Œì…œ ê¸°ëŠ¥ (14ê°œ API)** | **ìºë¦­í„°/ìŠ¤í† ë¦¬ ì¢‹ì•„ìš”, ëŒ“ê¸€** | **âœ…** |
| POST /characters/{id}/like | ìºë¦­í„° ì¢‹ì•„ìš” | âœ… |
| DELETE /characters/{id}/like | ìºë¦­í„° ì¢‹ì•„ìš” ì·¨ì†Œ | âœ… |
| GET /characters/{id}/like-status | ìºë¦­í„° ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ | âœ… |
| POST /characters/{id}/comments | ìºë¦­í„° ëŒ“ê¸€ ìž‘ì„± | âœ… |
| GET /characters/{id}/comments | ìºë¦­í„° ëŒ“ê¸€ ëª©ë¡ | âœ… |
| PUT /comments/{id} | ëŒ“ê¸€ ìˆ˜ì • | âœ… |
| DELETE /comments/{id} | ëŒ“ê¸€ ì‚­ì œ | âœ… |
| POST /stories/{id}/like | ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” | âœ… |
| DELETE /stories/{id}/like | ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” ì·¨ì†Œ | âœ… |
| GET /stories/{id}/like-status | ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ | âœ… |
| POST /stories/{id}/comments | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ìž‘ì„± | âœ… |
| GET /stories/{id}/comments | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ëª©ë¡ | âœ… |
| PUT /story-comments/{id} | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ìˆ˜ì • | âœ… |
| DELETE /story-comments/{id} | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì‚­ì œ | âœ… |

---

### ðŸŸ¢ 1ë‹¨ê³„ â€“ í¬ì¸íŠ¸/ê²°ì œ ì‹œìŠ¤í…œ (ì™„ë£Œ âœ…)
**ê°œë°œ ê¸°ê°„**: 2-3ì£¼ â†’ **ì™„ë£Œ: 2024.01.15**  
**ì´ìœ **: ìˆ˜ìµ ëª¨ë¸ì˜ í•µì‹¬ì´ë©°, ë‹¤ë¥¸ ê¸°ëŠ¥ë“¤ì˜ ê¸°ë°˜ì´ ë©ë‹ˆë‹¤.

#### âœ… **êµ¬í˜„ ì™„ë£Œëœ API**

| ìˆœì„œ | API | ì„¤ëª… | ì¤‘ìš”ë„ | ìƒíƒœ |
|:---:|-----|-----|:------:|:---:|
| 1 | POST /payment/products | ê²°ì œ ìƒí’ˆ ìƒì„± (ê´€ë¦¬ìž) | â­â­â­ | âœ… |
| 2 | GET /payment/products | ê²°ì œ ìƒí’ˆ ëª©ë¡ | â­â­â­ | âœ… |
| 3 | POST /payment/checkout | ê²°ì œ ìš”ì²­ (í† ìŠ¤íŽ˜ì´ë¨¼ì¸ ) | â­â­â­â­â­ | âœ… |
| 4 | POST /payment/webhook | ê²°ì œ ì™„ë£Œ ì›¹í›… | â­â­â­â­â­ | âœ… |
| 5 | GET /payment/history | ê²°ì œ ë‚´ì—­ ì¡°íšŒ | â­â­â­ | âœ… |
| 6 | GET /point/balance | í¬ì¸íŠ¸ ìž”ì•¡ ì¡°íšŒ | â­â­â­â­ | âœ… |
| 7 | POST /point/use | í¬ì¸íŠ¸ ì‚¬ìš© (ë‚´ë¶€ API) | â­â­â­â­â­ | âœ… |
| 8 | GET /point/transactions | í¬ì¸íŠ¸ ê±°ëž˜ ë‚´ì—­ ì¡°íšŒ | â­â­â­ | âœ… |
| 9 | GET /point/summary | í¬ì¸íŠ¸ í†µê³„ ìš”ì•½ | â­â­ | âœ… |

#### ðŸ“‹ **êµ¬í˜„ëœ ì£¼ìš” ê¸°ëŠ¥**

- **ê²°ì œ ìƒí’ˆ ê´€ë¦¬**: íŒ¨í‚¤ì§€ë³„ í¬ì¸íŠ¸ ìƒí’ˆ (1,000ì›~24,000ì›)
- **ê²°ì œ ì²˜ë¦¬**: í† ìŠ¤íŽ˜ì´ë¨¼ì¸  ì—°ë™ ì¤€ë¹„ (ê²°ì œ ìš”ì²­/ì™„ë£Œ ì›¹í›…)
- **í¬ì¸íŠ¸ ì‹œìŠ¤í…œ**: Redis ê¸°ë°˜ ì›ìžì  ì°¨ê° ë¡œì§
- **íŠ¸ëžœìž­ì…˜ ê¸°ë¡**: ì™„ì „í•œ í¬ì¸íŠ¸ ì´ë ¥ ê´€ë¦¬
- **ë°ì´í„°ë² ì´ìŠ¤**: 4ê°œ í…Œì´ë¸” (payment_products, payments, point_transactions, user_points)
- **ë³´ì•ˆ**: UUID ê¸°ë°˜ ID, ë™ì‹œì„± ì œì–´

#### ðŸ”§ **Redis í¬ì¸íŠ¸ ì°¨ê° (ì›ìžì  ì²˜ë¦¬) - êµ¬í˜„ ì™„ë£Œ**

```python
# backend-api/app/services/point_service.py - êµ¬í˜„ ì™„ë£Œ
async def deduct_points_atomic(
    redis: Redis,
    user_id: str,
    amount: int,
    reason: str
) -> bool:
    """Redis Lua ìŠ¤í¬ë¦½íŠ¸ë¡œ ì›ìžì  í¬ì¸íŠ¸ ì°¨ê°"""
    lua_script = """
    local user_key = KEYS[1]
    local amount = tonumber(ARGV[1])
    local current = tonumber(redis.call('GET', user_key) or 0)
    
    if current >= amount then
        redis.call('DECRBY', user_key, amount)
        return 1
    else
        return 0
    end
    """
    
    result = await redis.eval(
        lua_script,
        keys=[f"points:{user_id}"],
        args=[amount, reason]
    )
    
    return bool(result)
```

#### âœ… **ì™„ë£Œëœ ìž‘ì—…**
- âœ… í† ìŠ¤íŽ˜ì´ë¨¼ì¸  SDK ì—°ë™ ì¤€ë¹„
- âœ… Redis Lua ìŠ¤í¬ë¦½íŠ¸ ìž‘ì„±
- âœ… ê²°ì œ ì‹¤íŒ¨ ì‹œ ë¡¤ë°± ë¡œì§
- âœ… í¬ì¸íŠ¸ ë™ê¸°í™” ë°°ì¹˜ ìž‘ì—…
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸

---

### ðŸŸ¢ 1.5ë‹¨ê³„ â€“ ì†Œì…œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„ (ì™„ë£Œ âœ…)
**ê°œë°œ ê¸°ê°„**: 1ì£¼ â†’ **ì™„ë£Œ: 2024.01.15**  
**ì´ìœ **: ì‚¬ìš©ìž ì°¸ì—¬ë„ í–¥ìƒê³¼ ì½˜í…ì¸  ìƒí˜¸ìž‘ìš© í™œì„±í™”

#### âœ… **êµ¬í˜„ ì™„ë£Œëœ ì†Œì…œ ê¸°ëŠ¥ API**

| ìˆœì„œ | API | ì„¤ëª… | ì¤‘ìš”ë„ | ìƒíƒœ |
|:---:|-----|-----|:------:|:---:|
| 1 | POST /characters/{id}/like | ìºë¦­í„° ì¢‹ì•„ìš” | â­â­â­â­ | âœ… |
| 2 | DELETE /characters/{id}/like | ìºë¦­í„° ì¢‹ì•„ìš” ì·¨ì†Œ | â­â­â­â­ | âœ… |
| 3 | GET /characters/{id}/like-status | ìºë¦­í„° ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ | â­â­â­ | âœ… |
| 4 | POST /characters/{id}/comments | ìºë¦­í„° ëŒ“ê¸€ ìž‘ì„± | â­â­â­â­ | âœ… |
| 5 | GET /characters/{id}/comments | ìºë¦­í„° ëŒ“ê¸€ ëª©ë¡ | â­â­â­ | âœ… |
| 6 | PUT /comments/{id} | ëŒ“ê¸€ ìˆ˜ì • | â­â­â­ | âœ… |
| 7 | DELETE /comments/{id} | ëŒ“ê¸€ ì‚­ì œ | â­â­â­ | âœ… |
| 8 | POST /stories/{id}/like | ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” | â­â­â­â­ | âœ… |
| 9 | DELETE /stories/{id}/like | ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” ì·¨ì†Œ | â­â­â­â­ | âœ… |
| 10 | GET /stories/{id}/like-status | ìŠ¤í† ë¦¬ ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ | â­â­â­ | âœ… |
| 11 | POST /stories/{id}/comments | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ìž‘ì„± | â­â­â­â­ | âœ… |
| 12 | GET /stories/{id}/comments | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ëª©ë¡ | â­â­â­ | âœ… |
| 13 | PUT /story-comments/{id} | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ìˆ˜ì • | â­â­â­ | âœ… |
| 14 | DELETE /story-comments/{id} | ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì‚­ì œ | â­â­â­ | âœ… |

#### ðŸ“‹ **êµ¬í˜„ëœ ì£¼ìš” ê¸°ëŠ¥**

- **ìºë¦­í„° ì†Œì…œ ê¸°ëŠ¥**: ì¢‹ì•„ìš”, ëŒ“ê¸€ ì™„ì „ êµ¬í˜„
- **ìŠ¤í† ë¦¬ ì†Œì…œ ê¸°ëŠ¥**: ì¢‹ì•„ìš”, ëŒ“ê¸€ ì™„ì „ êµ¬í˜„ (ìƒˆë¡œ ì¶”ê°€)
- **ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸**: ì‚¬ìš©ìžë³„ ì¢‹ì•„ìš” ìƒíƒœ ì‹¤ì‹œê°„ í™•ì¸
- **ëŒ“ê¸€ ìˆ˜ ìžë™ ì¶”ì **: DB íŠ¸ë¦¬ê±° ê¸°ë°˜ ìžë™ ì¹´ìš´íŒ…
- **ë°ì´í„°ë² ì´ìŠ¤**: StoryComment í…Œì´ë¸” + ìžë™ ì¹´ìš´íŒ… íŠ¸ë¦¬ê±° ì¶”ê°€
- **ë³´ì•ˆ**: JWT ê¸°ë°˜ ì¸ì¦, ìž‘ì„±ìž ê¶Œí•œ í™•ì¸

#### ðŸ”§ **ëŒ“ê¸€ ìˆ˜ ìžë™ ì¶”ì  ì‹œìŠ¤í…œ - êµ¬í˜„ ì™„ë£Œ**

```sql
-- ìŠ¤í† ë¦¬ ëŒ“ê¸€ ìˆ˜ ìžë™ ì—…ë°ì´íŠ¸ íŠ¸ë¦¬ê±°
CREATE OR REPLACE FUNCTION update_story_comment_count()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'INSERT' THEN
        UPDATE stories 
        SET comment_count = comment_count + 1 
        WHERE id = NEW.story_id;
        RETURN NEW;
    ELSIF TG_OP = 'DELETE' THEN
        UPDATE stories 
        SET comment_count = comment_count - 1 
        WHERE id = OLD.story_id;
        RETURN OLD;
    END IF;
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER story_comment_count_trigger
    AFTER INSERT OR DELETE ON story_comments
    FOR EACH ROW
    EXECUTE FUNCTION update_story_comment_count();
```

#### âœ… **ì™„ë£Œëœ ìž‘ì—…**
- âœ… ìŠ¤í† ë¦¬ ëŒ“ê¸€ ëª¨ë¸ ë° ê´€ê³„ ì„¤ì •
- âœ… ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì„œë¹„ìŠ¤ ë¡œì§ êµ¬í˜„
- âœ… ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸ API êµ¬í˜„
- âœ… ëŒ“ê¸€ ìˆ˜ ìžë™ ì¶”ì  íŠ¸ë¦¬ê±° êµ¬í˜„
- âœ… ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
- âœ… ì†Œì…œ ê¸°ëŠ¥ API í†µí•© í…ŒìŠ¤íŠ¸ ì™„ë£Œ

---

### ðŸŸ¡ 2ë‹¨ê³„ â€“ ì•Œë¦¼ ì‹œìŠ¤í…œ (í˜„ìž¬ ìš°ì„ ìˆœìœ„)
**ê°œë°œ ê¸°ê°„**: 1-2ì£¼  
**ì´ìœ **: ì‚¬ìš©ìž ê²½í—˜ í–¥ìƒì˜ í•µì‹¬ì´ë©°, ë¦¬í…ì…˜ì— ì¤‘ìš”í•©ë‹ˆë‹¤.

#### âœ… **ê°œë°œí•  API**

| ìˆœì„œ | API | ì„¤ëª… | ì¤‘ìš”ë„ |
|:---:|-----|-----|:------:|
| 1 | GET /notifications | ì•Œë¦¼ ëª©ë¡ ì¡°íšŒ | â­â­â­ |
| 2 | PUT /notifications/{id}/read | ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ | â­â­â­ |
| 3 | POST /notifications/settings | ì•Œë¦¼ ì„¤ì • ë³€ê²½ | â­â­ |
| 4 | WebSocket /ws/notifications | ì‹¤ì‹œê°„ ì•Œë¦¼ | â­â­â­â­ |

#### ðŸ“ **ì‹¤ì‹œê°„ ì•Œë¦¼ êµ¬í˜„**

```javascript
// chat-server/src/services/notificationService.js
class NotificationService {
    async sendRealTimeNotification(userId, notification) {
        // 1. DBì— ì•Œë¦¼ ì €ìž¥
        await this.saveNotification(notification);
        
        // 2. Redis Pub/Subìœ¼ë¡œ ì‹¤ì‹œê°„ ì „ì†¡
        await redis.publish(`notifications:${userId}`, JSON.stringify({
            type: 'NEW_NOTIFICATION',
            data: notification
        }));
        
        // 3. ì˜¤í”„ë¼ì¸ ì‚¬ìš©ìžë¥¼ ìœ„í•œ í‘¸ì‹œ ì•Œë¦¼
        if (!this.isUserOnline(userId)) {
            await this.sendPushNotification(userId, notification);
        }
    }
}
```

---

### ðŸŸ¡ 3ë‹¨ê³„ â€“ ëž­í‚¹/ì¶”ì²œ ì‹œìŠ¤í…œ
**ê°œë°œ ê¸°ê°„**: 1ì£¼  
**ì´ìœ **: ì‚¬ìš©ìž ì°¸ì—¬ë„ í–¥ìƒê³¼ ì½˜í…ì¸  ë°œê²¬ì„± ê°œì„ 

#### âœ… **ê°œë°œí•  API**

| ìˆœì„œ | API | ì„¤ëª… | ì¤‘ìš”ë„ |
|:---:|-----|-----|:------:|
| 1 | GET /rankings/characters | ì¸ê¸° ìºë¦­í„° TOP 100 | â­â­â­â­ |
| 2 | GET /rankings/stories | ì¸ê¸° ìŠ¤í† ë¦¬ TOP 100 | â­â­â­ |
| 3 | GET /recommendations/characters | ê°œì¸í™” ìºë¦­í„° ì¶”ì²œ | â­â­â­â­ |
| 4 | GET /trending/daily | ì¼ê°„ íŠ¸ë Œë”© | â­â­â­ |

#### ðŸ”§ **Redis Sorted Set í™œìš©**

```python
# ëž­í‚¹ ì—…ë°ì´íŠ¸ (ì‹¤ì‹œê°„)
async def update_character_ranking(redis: Redis, character_id: str, score_delta: int):
    """ìºë¦­í„° ëž­í‚¹ ì—…ë°ì´íŠ¸"""
    # ì¼ê°„/ì£¼ê°„/ì›”ê°„ ëž­í‚¹ ë™ì‹œ ì—…ë°ì´íŠ¸
    today = datetime.now().strftime("%Y%m%d")
    week = datetime.now().strftime("%Y%W")
    month = datetime.now().strftime("%Y%m")
    
    pipe = redis.pipeline()
    pipe.zincrby(f"ranking:character:daily:{today}", score_delta, character_id)
    pipe.zincrby(f"ranking:character:weekly:{week}", score_delta, character_id)
    pipe.zincrby(f"ranking:character:monthly:{month}", score_delta, character_id)
    pipe.zincrby("ranking:character:all", score_delta, character_id)
    await pipe.execute()
```

---

### ðŸŸ¡ 4ë‹¨ê³„ â€“ TTS/ì´ë¯¸ì§€ ìƒì„±
**ê°œë°œ ê¸°ê°„**: 2ì£¼  
**ì´ìœ **: ì°¨ë³„í™” ìš”ì†Œì´ë©° í”„ë¦¬ë¯¸ì—„ ê¸°ëŠ¥ìœ¼ë¡œ ìˆ˜ìµí™” ê°€ëŠ¥

#### âœ… **ê°œë°œí•  API**

| ìˆœì„œ | API | ì„¤ëª… | ì¤‘ìš”ë„ |
|:---:|-----|-----|:------:|
| 1 | POST /ai/tts | í…ìŠ¤íŠ¸ â†’ ìŒì„± ë³€í™˜ | â­â­â­ |
| 2 | POST /ai/image | ìºë¦­í„° ì´ë¯¸ì§€ ìƒì„± | â­â­â­â­ |
| 3 | GET /ai/voices | ì‚¬ìš© ê°€ëŠ¥í•œ ìŒì„± ëª©ë¡ | â­â­ |
| 4 | POST /ai/image/variations | ì´ë¯¸ì§€ ë³€í˜• ìƒì„± | â­â­ |

---

## ðŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (PostgreSQL/SQLite)

**[í˜„í™© ë¶„ì„]** ì•„ëž˜ëŠ” í˜„ìž¬ `test.db`ì— êµ¬í˜„ëœ ì‹¤ì œ í…Œì´ë¸” ìŠ¤í‚¤ë§ˆì™€ `app/models`ì— ì •ì˜ëœ SQLAlchemy ëª¨ë¸ì„ ê¸°ì¤€ìœ¼ë¡œ ìµœì‹ í™”ëœ ë‚´ìš©ìž…ë‹ˆë‹¤.

### ðŸŸ¢ í•µì‹¬ ê¸°ëŠ¥ í…Œì´ë¸” (êµ¬í˜„ ì™„ë£Œ)

#### users (ì‚¬ìš©ìž)
- `id`, `email`, `username`, `hashed_password`, `is_active`, `is_verified`, `created_at`, `updated_at`

#### characters (ìºë¦­í„° - CAVEDUCK ê³ ê¸‰ ëª¨ë¸)
- **ê¸°ë³¸**: `id`, `creator_id`, `name`, `description`, `personality`, `background_story`, `avatar_url`
- **ì‹ ê·œ/í™•ìž¥**: `speech_style`, `greeting`, `world_setting`, `user_display_description`, `use_custom_description`, `introduction_scenes`, `character_type`, `base_language`, `image_descriptions`, `voice_settings`, `has_affinity_system`, `affinity_rules`, `affinity_stages`, `custom_module_id`, `use_translation`
- **ìƒíƒœ/í†µê³„**: `is_public`, `is_active`, `chat_count`, `like_count`

#### character_settings (ìºë¦­í„° AI ì„¤ì •)
- `id`, `character_id`, `system_prompt`, `temperature`, `max_tokens`, `ai_model`
- **ì‹ ê·œ/í™•ìž¥**: `custom_prompt_template`, `use_memory`, `memory_length`, `response_style`

#### character_example_dialogues (ìºë¦­í„° ì˜ˆì‹œ ëŒ€í™”)
- `id`, `character_id`, `user_message`, `character_response`, `order_index`, `created_at`

#### world_settings (ì„¸ê³„ê´€ ì„¤ì •)
- `id`, `creator_id`, `name`, `description`, `rules`, `is_public`, `usage_count`

#### custom_modules (ì»¤ìŠ¤í…€ ëª¨ë“ˆ)
- `id`, `creator_id`, `name`, `description`, `custom_prompt`, `lorebook`

### ðŸŸ¢ ì±„íŒ… ë° ìŠ¤í† ë¦¬ í…Œì´ë¸” (êµ¬í˜„ ì™„ë£Œ)

#### chat_rooms (ì±„íŒ…ë°©)
- `id`, `user_id`, `character_id`, `title`, `message_count`

#### chat_messages (ì±„íŒ… ë©”ì‹œì§€)
- `id`, `chat_room_id`, `sender_type`, `content`, `message_metadata`

#### stories (ìŠ¤í† ë¦¬)
- `id`, `creator_id`, `character_id`, `title`, `content`, `summary`, `genre`, `is_public`, `is_featured`, `view_count`, `like_count`

### ðŸŸ¢ ì†Œì…œ ê¸°ëŠ¥ í…Œì´ë¸” (êµ¬í˜„ ì™„ë£Œ)

#### character_likes (ìºë¦­í„° ì¢‹ì•„ìš”)
- `id`, `user_id`, `character_id`

#### story_likes (ìŠ¤í† ë¦¬ ì¢‹ì•„ìš”)
- `id`, `user_id`, `story_id`

#### character_comments (ìºë¦­í„° ëŒ“ê¸€)
- `id`, `character_id`, `user_id`, `content`

#### story_comments (ìŠ¤í† ë¦¬ ëŒ“ê¸€)
- `id`, `story_id`, `user_id`, `content`

### ðŸŸ¢ ê²°ì œ ë° í¬ì¸íŠ¸ í…Œì´ë¸” (êµ¬í˜„ ì™„ë£Œ)

#### payment_products (ê²°ì œ ìƒí’ˆ)
- `id`, `name`, `description`, `price`, `point_amount`, `bonus_point`, `is_active`, `sort_order`

#### payments (ê²°ì œ ë‚´ì—­)
- `id`, `user_id`, `product_id`, `amount`, `point_amount`, `status`, `payment_method`, `payment_key`, `order_id`, `transaction_data`

#### point_transactions (í¬ì¸íŠ¸ ê±°ëž˜ ë‚´ì—­)
- `id`, `user_id`, `type`, `amount`, `balance_after`, `description`, `reference_type`, `reference_id`

#### user_points (ì‚¬ìš©ìž í¬ì¸íŠ¸ ìž”ì•¡)
- `user_id`, `balance`, `total_charged`, `total_used`, `last_charged_at`

### ðŸ”´ ë¯¸êµ¬í˜„ í…Œì´ë¸” (ë¡œë“œë§µ ê³„íš)
- `notifications` (ì•Œë¦¼)
- `notification_settings` (ì•Œë¦¼ ì„¤ì •)
- `character_rankings` (ìºë¦­í„° ëž­í‚¹ ìŠ¤ëƒ…ìƒ·)












#### users (ì‚¬ìš©ìž)
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    email VARCHAR(255) UNIQUE NOT NULL,
    username VARCHAR(50) UNIQUE NOT NULL,
    hashed_password VARCHAR(255) NOT NULL,
    is_active BOOLEAN DEFAULT true,
    is_verified BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_username ON users(username);
```

#### characters (ìºë¦­í„°)
```sql
CREATE TABLE characters (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    creator_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    personality TEXT,
    background_story TEXT,
    avatar_url VARCHAR(500),
    is_public BOOLEAN DEFAULT true,
    is_active BOOLEAN DEFAULT true,
    chat_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_characters_creator ON characters(creator_id);
CREATE INDEX idx_characters_public_active ON characters(is_public, is_active);
CREATE INDEX idx_characters_popularity ON characters(chat_count DESC, like_count DESC);
```

### ðŸ”´ ìƒˆë¡œ ì¶”ê°€í•  í…Œì´ë¸” âŒ

#### payment_products (ê²°ì œ ìƒí’ˆ)
```sql
CREATE TABLE payment_products (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price INTEGER NOT NULL,  -- ì›í™” ê¸°ì¤€
    point_amount INTEGER NOT NULL,  -- ì§€ê¸‰ í¬ì¸íŠ¸
    bonus_point INTEGER DEFAULT 0,  -- ë³´ë„ˆìŠ¤ í¬ì¸íŠ¸
    is_active BOOLEAN DEFAULT true,
    sort_order INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- ìƒ˜í”Œ ë°ì´í„°
INSERT INTO payment_products (name, price, point_amount, bonus_point) VALUES
('ìŠ¤íƒ€í„° íŒ©', 1000, 100, 0),
('ë² ì´ì§ íŒ©', 4500, 500, 50),
('í”„ë¦¬ë¯¸ì—„ íŒ©', 8500, 1000, 150),
('ì–¼í‹°ë°‹ íŒ©', 24000, 3000, 600);
```

#### payments (ê²°ì œ ë‚´ì—­)
```sql
CREATE TABLE payments (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id),
    product_id UUID REFERENCES payment_products(id),
    amount INTEGER NOT NULL,
    point_amount INTEGER NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',  -- pending, success, failed, cancelled
    payment_method VARCHAR(50),  -- card, kakao_pay, naver_pay, toss
    payment_key VARCHAR(200) UNIQUE,  -- PGì‚¬ ê³ ìœ  í‚¤
    order_id VARCHAR(200) UNIQUE NOT NULL,
    transaction_data JSONB,  -- PGì‚¬ ì‘ë‹µ ì „ì²´ ì €ìž¥
    failed_reason TEXT,
    paid_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_payments_user ON payments(user_id);
CREATE INDEX idx_payments_status ON payments(status);
CREATE INDEX idx_payments_created ON payments(created_at DESC);
```

#### point_transactions (í¬ì¸íŠ¸ ê±°ëž˜ ë‚´ì—­)
```sql
CREATE TABLE point_transactions (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id),
    type VARCHAR(20) NOT NULL,  -- charge, use, refund, bonus
    amount INTEGER NOT NULL,  -- ì–‘ìˆ˜: ì¶©ì „, ìŒìˆ˜: ì‚¬ìš©
    balance_after INTEGER NOT NULL,  -- ê±°ëž˜ í›„ ìž”ì•¡
    description VARCHAR(200),
    reference_type VARCHAR(50),  -- payment, chat, story, etc
    reference_id UUID,  -- ê´€ë ¨ ë ˆì½”ë“œ ID
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_point_tx_user ON point_transactions(user_id);
CREATE INDEX idx_point_tx_created ON point_transactions(created_at DESC);
CREATE INDEX idx_point_tx_type ON point_transactions(type);
```

#### user_points (ì‚¬ìš©ìž í¬ì¸íŠ¸ ìž”ì•¡)
```sql
CREATE TABLE user_points (
    user_id UUID PRIMARY KEY REFERENCES users(id),
    balance INTEGER NOT NULL DEFAULT 0 CHECK (balance >= 0),
    total_charged INTEGER DEFAULT 0,
    total_used INTEGER DEFAULT 0,
    last_charged_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- íŠ¸ë¦¬ê±°: point_transactions ìƒì„± ì‹œ user_points ìžë™ ì—…ë°ì´íŠ¸
CREATE OR REPLACE FUNCTION update_user_points() RETURNS TRIGGER AS $$
BEGIN
    UPDATE user_points 
    SET balance = balance + NEW.amount,
        total_charged = CASE WHEN NEW.amount > 0 THEN total_charged + NEW.amount ELSE total_charged END,
        total_used = CASE WHEN NEW.amount < 0 THEN total_used - NEW.amount ELSE total_used END,
        updated_at = CURRENT_TIMESTAMP
    WHERE user_id = NEW.user_id;
    
    -- ìž”ì•¡ì´ ì—†ìœ¼ë©´ ìƒì„±
    IF NOT FOUND THEN
        INSERT INTO user_points (user_id, balance) 
        VALUES (NEW.user_id, NEW.amount);
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_user_points_trigger
AFTER INSERT ON point_transactions
FOR EACH ROW EXECUTE FUNCTION update_user_points();
```

#### notifications (ì•Œë¦¼)
```sql
CREATE TABLE notifications (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    type VARCHAR(50) NOT NULL,  -- payment_complete, character_liked, new_comment, etc
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    data JSONB,  -- ì¶”ê°€ ë°ì´í„°
    is_read BOOLEAN DEFAULT false,
    read_at TIMESTAMP WITH TIME ZONE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_notifications_user_unread ON notifications(user_id, is_read) WHERE is_read = false;
CREATE INDEX idx_notifications_created ON notifications(created_at DESC);
```

#### notification_settings (ì•Œë¦¼ ì„¤ì •)
```sql
CREATE TABLE notification_settings (
    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,
    payment_notifications BOOLEAN DEFAULT true,
    social_notifications BOOLEAN DEFAULT true,
    chat_notifications BOOLEAN DEFAULT true,
    marketing_notifications BOOLEAN DEFAULT false,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

#### character_rankings (ìºë¦­í„° ëž­í‚¹ ìŠ¤ëƒ…ìƒ·)
```sql
CREATE TABLE character_rankings (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    character_id UUID NOT NULL REFERENCES characters(id) ON DELETE CASCADE,
    period_type VARCHAR(20) NOT NULL,  -- daily, weekly, monthly, all_time
    period_date DATE NOT NULL,
    rank INTEGER NOT NULL,
    score INTEGER NOT NULL,
    chat_count INTEGER DEFAULT 0,
    like_count INTEGER DEFAULT 0,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

CREATE UNIQUE INDEX idx_rankings_unique ON character_rankings(character_id, period_type, period_date);
CREATE INDEX idx_rankings_lookup ON character_rankings(period_type, period_date, rank);
```

---

## ðŸš€ ê¸°ìˆ  êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### 1. í¬ì¸íŠ¸ ì°¨ê° ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
ì‚¬ìš©ìž ìš”ì²­
    â†“
[API Gateway]
    â†“
[í¬ì¸íŠ¸ í™•ì¸] â† Redis Cache
    â†“
[ì›ìžì  ì°¨ê°] â† Redis Lua Script
    â†“
[ë©”ì‹œì§€ í] â†’ Kafka/RabbitMQ
    â†“
[ë¹„ë™ê¸° ì²˜ë¦¬] â†’ DB ë™ê¸°í™”
```

### 2. ì‹¤ì‹œê°„ ì•Œë¦¼ ì•„í‚¤í…ì²˜

```
ì´ë²¤íŠ¸ ë°œìƒ
    â†“
[Notification Service]
    â†“
[Redis Pub/Sub] â†’ ì˜¨ë¼ì¸ ì‚¬ìš©ìž
    â†“
[FCM/APNs] â†’ ì˜¤í”„ë¼ì¸ ì‚¬ìš©ìž
```

### 3. ìºì‹± ì „ëžµ

| ë°ì´í„° ìœ í˜• | ìºì‹œ TTL | ìºì‹œ í‚¤ |
|-----------|---------|--------|
| ì‚¬ìš©ìž í¬ì¸íŠ¸ | 5ë¶„ | points:{user_id} |
| ìºë¦­í„° ì •ë³´ | 1ì‹œê°„ | character:{id} |
| ëž­í‚¹ ë°ì´í„° | 10ë¶„ | ranking:{type}:{period} |
| ì„¸ì…˜ ë°ì´í„° | 24ì‹œê°„ | session:{token} |

---

## ðŸ” ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ê²°ì œ ë³´ì•ˆ
- **HTTPS í•„ìˆ˜**: ëª¨ë“  ê²°ì œ ê´€ë ¨ í†µì‹ 
- **ì›¹í›… ê²€ì¦**: IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ + ì„œëª… ê²€ì¦
- **ì¤‘ë³µ ë°©ì§€**: Idempotency Key ì‚¬ìš©
- **ë¡œê¹…**: ëª¨ë“  ê²°ì œ ì´ë²¤íŠ¸ ìƒì„¸ ë¡œê¹…

### 2. í¬ì¸íŠ¸ ë³´ì•ˆ
- **ì›ìžì  ì²˜ë¦¬**: Redis Lua ìŠ¤í¬ë¦½íŠ¸
- **ì´ì¤‘ ì°¨ê° ë°©ì§€**: ê±°ëž˜ ID ê¸°ë°˜ ì¤‘ë³µ ì²´í¬
- **ë¡¤ë°± ë©”ì»¤ë‹ˆì¦˜**: ì‹¤íŒ¨ ì‹œ ìžë™ ë³µêµ¬
- **ê°ì‚¬ ë¡œê·¸**: ëª¨ë“  í¬ì¸íŠ¸ ë³€ë™ ì¶”ì 

### 3. API ë³´ì•ˆ
- **Rate Limiting**: IP/ì‚¬ìš©ìžë³„ ì œí•œ
- **JWT ë§Œë£Œ**: Access Token 30ë¶„, Refresh Token 7ì¼
- **CORS ì„¤ì •**: í—ˆìš©ëœ ë„ë©”ì¸ë§Œ
- **SQL Injection ë°©ì§€**: ORM ì‚¬ìš©, íŒŒë¼ë¯¸í„° ë°”ì¸ë”©

---

## ðŸ“ˆ ì„±ëŠ¥ ìµœì í™” ì „ëžµ

### 1. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”
```sql
-- ë³µí•© ì¸ë±ìŠ¤ ì¶”ê°€
CREATE INDEX idx_payments_user_status_created 
ON payments(user_id, status, created_at DESC);

-- íŒŒí‹°ì…”ë‹ (ì›”ë³„)
CREATE TABLE point_transactions_2024_01 
PARTITION OF point_transactions 
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');
```

### 2. Redis ìµœì í™”
```python
# íŒŒì´í”„ë¼ì¸ ì‚¬ìš©
async def bulk_update_rankings(updates: List[RankingUpdate]):
    pipe = redis.pipeline()
    for update in updates:
        pipe.zincrby(f"ranking:{update.type}", update.score, update.id)
    await pipe.execute()
```

### 3. API ì‘ë‹µ ìµœì í™”
- **íŽ˜ì´ì§€ë„¤ì´ì…˜**: Cursor ê¸°ë°˜ êµ¬í˜„
- **í•„ë“œ ì„ íƒ**: GraphQL ìŠ¤íƒ€ì¼ sparse fieldsets
- **ì••ì¶•**: gzip ì‘ë‹µ ì••ì¶•
- **CDN**: ì •ì  ë¦¬ì†ŒìŠ¤ ìºì‹±

---

## ðŸ§ª í…ŒìŠ¤íŠ¸ ì „ëžµ

### 1. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
```python
# í¬ì¸íŠ¸ ì°¨ê° í…ŒìŠ¤íŠ¸
async def test_point_deduction():
    # Given
    user_id = "test_user"
    initial_points = 1000
    deduct_amount = 100
    
    # When
    result = await deduct_points_atomic(redis, user_id, deduct_amount, "test")
    
    # Then
    assert result == True
    balance = await redis.get(f"points:{user_id}")
    assert int(balance) == initial_points - deduct_amount
```

### 2. í†µí•© í…ŒìŠ¤íŠ¸
- **ê²°ì œ í”Œë¡œìš°**: ìš”ì²­ â†’ ì›¹í›… â†’ í¬ì¸íŠ¸ ì¶©ì „
- **ë™ì‹œì„± í…ŒìŠ¤íŠ¸**: ë™ì‹œ í¬ì¸íŠ¸ ì°¨ê°
- **ë¡¤ë°± í…ŒìŠ¤íŠ¸**: ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤

### 3. ë¶€í•˜ í…ŒìŠ¤íŠ¸
- **ë„êµ¬**: Locust, K6
- **ëª©í‘œ**: ë™ì‹œ ì ‘ì† 10,000ëª…, TPS 5,000
- **ì‹œë‚˜ë¦¬ì˜¤**: ê²°ì œ, í¬ì¸íŠ¸ ì°¨ê°, ëž­í‚¹ ì¡°íšŒ

---

## ðŸš€ ë°°í¬ ì „ëžµ

### 1. í™˜ê²½ êµ¬ì„±
| í™˜ê²½ | ìš©ë„ | ì¸í”„ë¼ |
|-----|-----|--------|
| Local | ê°œë°œ | Docker Compose |
| Dev | ê°œë°œ í…ŒìŠ¤íŠ¸ | K8s (1 replica) |
| Staging | ë°°í¬ ì „ ê²€ì¦ | K8s (2 replicas) |
| Production | ì‹¤ ì„œë¹„ìŠ¤ | K8s (Auto-scaling) |

### 2. ë°°í¬ í”„ë¡œì„¸ìŠ¤
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production
on:
  push:
    tags:
      - 'v*'

jobs:
  deploy:
    steps:
      - name: Run Tests
      - name: Build Docker Image
      - name: Push to Registry
      - name: Deploy to K8s
      - name: Health Check
      - name: Rollback if Failed
```

### 3. ëª¨ë‹ˆí„°ë§
- **APM**: DataDog, New Relic
- **ë¡œê¹…**: ELK Stack
- **ë©”íŠ¸ë¦­**: Prometheus + Grafana
- **ì•Œë¦¼**: PagerDuty

---

## ðŸ“… ê°œë°œ ì¼ì • (ì´ 5-7ì£¼ ë‚¨ìŒ)

| ì£¼ì°¨ | ìž‘ì—… ë‚´ìš© | ë‹´ë‹¹ | ìƒíƒœ |
|-----|----------|------|------|
| ~~1-3ì£¼~~ | ~~ê²°ì œ/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ~~ | ~~ë°±ì—”ë“œ~~ | âœ… ì™„ë£Œ |
| ~~1ì£¼~~ | ~~ì†Œì…œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„~~ | ~~ë°±ì—”ë“œ~~ | âœ… ì™„ë£Œ |
| 1-2ì£¼ | ê²°ì œ UI/UX | í”„ë¡ íŠ¸ì—”ë“œ | ðŸ”„ ì§„í–‰ |
| 2-3ì£¼ | ì•Œë¦¼ ì‹œìŠ¤í…œ | í’€ìŠ¤íƒ | ðŸ“‹ ì˜ˆì • |
| 3-4ì£¼ | ëž­í‚¹/ì¶”ì²œ | ë°±ì—”ë“œ | ðŸ“‹ ì˜ˆì • |
| 4-5ì£¼ | TTS/ì´ë¯¸ì§€ | AI íŒ€ | ðŸ“‹ ì˜ˆì • |
| 5-6ì£¼ | í†µí•© í…ŒìŠ¤íŠ¸ | QA | ðŸ“‹ ì˜ˆì • |
| 6-7ì£¼ | ì„±ëŠ¥ ìµœì í™” | DevOps | ðŸ“‹ ì˜ˆì • |
| 7ì£¼ | ë°°í¬ ì¤€ë¹„ | ì „ì²´ | ðŸ“‹ ì˜ˆì • |

### ðŸŽ¯ **í˜„ìž¬ ìƒí™© (2024.01.15)**
- âœ… **1ë‹¨ê³„ ì™„ë£Œ**: ê²°ì œ/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ë°±ì—”ë“œ ë¡œì§ ì™„ë£Œ
- âœ… **1.5ë‹¨ê³„ ì™„ë£Œ**: ì†Œì…œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„ ì™„ë£Œ (14ê°œ API)
- ðŸ”„ **ì§„í–‰ ì¤‘**: í”„ë¡ íŠ¸ì—”ë“œ ê²°ì œ UI/UX ê°œë°œ í•„ìš”
- ðŸ“‹ **ë‹¤ìŒ ë‹¨ê³„**: ì•Œë¦¼ ì‹œìŠ¤í…œ ê°œë°œ ì‹œìž‘

---

## ðŸ’° ì˜ˆìƒ ë¹„ìš©

| í•­ëª© | ì›” ë¹„ìš© | ë¹„ê³  |
|-----|--------|-----|
| ì„œë²„ (AWS) | $500-1000 | Auto-scaling |
| DB (RDS) | $200-400 | Multi-AZ |
| Redis | $100-200 | ElastiCache |
| AI API | $300-1000 | ì‚¬ìš©ëŸ‰ ê¸°ë°˜ |
| CDN | $50-100 | CloudFront |
| ëª¨ë‹ˆí„°ë§ | $100-200 | DataDog |
| **ì´ê³„** | **$1,250-2,900** | íŠ¸ëž˜í”½ ê¸°ë°˜ |

---

## ðŸŽ¯ KPI ëª©í‘œ

| ì§€í‘œ | 3ê°œì›” | 6ê°œì›” | 1ë…„ |
|-----|-------|-------|-----|
| MAU | 10K | 50K | 200K |
| ìœ ë£Œ ì „í™˜ìœ¨ | 2% | 5% | 10% |
| ARPPU | â‚©5,000 | â‚©10,000 | â‚©15,000 |
| ì¼ì¼ ì±„íŒ… ìˆ˜ | 50K | 500K | 2M |
| ì„œë²„ ì‘ë‹µì‹œê°„ | <200ms | <150ms | <100ms |

---

## ðŸ” ë¦¬ìŠ¤í¬ ê´€ë¦¬

| ë¦¬ìŠ¤í¬ | ì˜í–¥ë„ | ëŒ€ì‘ ë°©ì•ˆ |
|--------|-------|----------|
| AI API ë¹„ìš© í­ì¦ | ë†’ìŒ | ì‚¬ìš©ëŸ‰ ì œí•œ, ìºì‹± ê°•í™” |
| DDoS ê³µê²© | ë†’ìŒ | Cloudflare, Rate Limiting |
| ë°ì´í„° ìœ ì‹¤ | ë§¤ìš° ë†’ìŒ | ë°±ì—…, ë³µì œ, ê°ì‚¬ ë¡œê·¸ |
| ê·œì œ ë³€ê²½ | ì¤‘ê°„ | ë²•ë¬´ ê²€í† , ì•½ê´€ ì—…ë°ì´íŠ¸ |

---

## ðŸ“š ì°¸ê³  ìžë£Œ

1. **ê²°ì œ ì—°ë™**
   - [í† ìŠ¤íŽ˜ì´ë¨¼ì¸  ê°œë°œìž ë¬¸ì„œ](https://docs.tosspayments.com)
   - [ì¹´ì¹´ì˜¤íŽ˜ì´ API](https://developers.kakao.com/docs/latest/ko/kakaopay/common)

2. **Redis ìµœì í™”**
   - [Redis Lua Scripting](https://redis.io/docs/manual/programmability/eval-intro/)
   - [Redis Best Practices](https://redis.io/docs/manual/patterns/)

3. **ì„±ëŠ¥ ìµœì í™”**
   - [FastAPI Performance](https://fastapi.tiangolo.com/deployment/concepts/)
   - [PostgreSQL Tuning](https://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server)

---

**ìž‘ì„±ì¼**: 2025ë…„ 7ì›” 11ì¼  
**ìµœê·¼ ì—…ë°ì´íŠ¸**: 2024ë…„ 1ì›” 15ì¼  
**ë²„ì „**: 2.2  
**ìž‘ì„±ìž**: AI ìºë¦­í„°ì±— í”Œëž«í¼ ê°œë°œíŒ€  

### ðŸ“ **ìµœê·¼ ì—…ë°ì´íŠ¸ ë‚´ì—­**
- **2024.01.15**: 1ë‹¨ê³„ ê²°ì œ/í¬ì¸íŠ¸ ì‹œìŠ¤í…œ ë°±ì—”ë“œ êµ¬í˜„ ì™„ë£Œ
- **êµ¬í˜„ ì™„ë£Œ**: 9ê°œ API ì—”ë“œí¬ì¸íŠ¸, Redis ì›ìžì  ì²˜ë¦¬, 4ê°œ í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜
- **2024.01.15**: 1.5ë‹¨ê³„ ì†Œì…œ ê¸°ëŠ¥ ì™„ì „ êµ¬í˜„ ì™„ë£Œ
- **êµ¬í˜„ ì™„ë£Œ**: 14ê°œ ì†Œì…œ API, ìŠ¤í† ë¦¬ ëŒ“ê¸€ ì‹œìŠ¤í…œ, ì¢‹ì•„ìš” ìƒíƒœ í™•ì¸, ëŒ“ê¸€ ìˆ˜ ìžë™ ì¶”ì 
- **ì§„í–‰ ìƒí™©**: 8-10ì£¼ â†’ 5-7ì£¼ ë‚¨ìŒ, ë‹¤ìŒ ìš°ì„ ìˆœìœ„ëŠ” ì•Œë¦¼ ì‹œìŠ¤í…œ 