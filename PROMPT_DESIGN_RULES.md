# 프롬프트 설계 규칙(모드별) - 운영용 요약

이 문서는 외부 캐릭터챗/프롬프트 툴(SillyTavern, JanitorAI 등)에서 공통적으로 확인되는 **“블록형 컨텍스트 설계”**를,
우리 프로젝트(일반 캐릭터챗: 시뮬/롤플레잉/커스텀)에 맞게 **재사용 가능한 규칙**으로 정리한 것이다.

## 핵심 원칙(SSOT/운영 안정)

- **블록형 구조**: 규칙/세계관/메모/이벤트/스탯/출력지침을 한 덩어리로 섞지 말고, 목적별 섹션으로 분리해 고정 순서로 배치한다.
- **모드 선언은 초기에**: 모델이 “관계(롤플레잉) vs 진행(시뮬) vs 크리에이터 제어(커스텀)” 중 무엇을 우선시해야 하는지 반드시 선언한다.
- **주입 컨텍스트는 ‘설명’이 아니라 ‘근거’**: 턴 사건/설정메모/스탯/엔딩 등은 “메타 설명”이 아니라 “대답에 자연스럽게 반영해야 하는 컨텍스트”로 취급한다.
- **형식 출력은 예시 + 금지로 안정화**: JSON 델타처럼 실패 위험이 있는 형식은 (1) 예시 2~3개 (2) 금지사항(코드펜스/주석/설명)으로 실패율을 낮춘다.

## 모드별 운영 의도(요약)

### 시뮬레이션(simulator)
- **목표/장애/대가/전진감**이 매 턴 느껴져야 한다.
- 선택/행동의 결과가 **누적**되어 다음 전개로 이어져야 한다.
- 서버가 주입하는 블록은 “컨텍스트”이며, **자연스럽게** 반영한다(메타 설명 금지).

### 롤플레잉(roleplay)
- 관계의 거리감/호감도/감정선을 우선한다.
- 사건 전개가 있더라도 **관계 변화**가 중심이 되게 한다.

### 커스텀(custom)
- **크리에이터 지시(Custom_Instruction) 최우선**.
- 다만 메타/분석/AI 언급 등 공통 금지 규칙은 유지한다.

## 코드 적용 위치(현재)

- `backend-api/app/api/chat.py`
  - `_build_character_mode_directive_block()` : 모드별 지침 블록(SSOT)
  - 프롬프트 조립 시 위 블록을 추가로 주입(프리뷰/첫응답/실채팅)

